(function(n){n.fn.bonsai=function(i){var r=arguments;return this.each(function(){var u=n(this).data("bonsai"),f;return u||(u=new t(this,i),n(this).data("bonsai",u)),typeof i=="string"?(f=i,u[f].apply(u,[].slice.call(r,1))):void 0})};n.bonsai={};n.bonsai.defaults={expandAll:!1,expand:null,collapse:null,addExpandAll:!1,addSelectAll:!1,selectAllExclude:null,idAttribute:"id",createInputs:!1,checkboxes:!1,handleDuplicateCheckboxes:!1,createRadioButtons:!1};var t=function(t,i){var r=this;if(i=i||{},this.options=n.extend({},n.bonsai.defaults,i),this.el=n(t).addClass("bonsai").data("bonsai",this),this.options.scope||(this.options.scope=this.el),this.update(),this.isRootNode()){this.options.createCheckboxes&&(this.createInputs="checkbox");this.options.handleDuplicateCheckboxes&&this.handleDuplicateCheckboxes();this.options.checkboxes&&this.el.qubit(this.options);this.options.addExpandAll&&this.addExpandAllLink();this.options.addSelectAll&&this.addSelectAllLink();this.el.on("click",".thumb",function(t){r.toggle(n(t.currentTarget).closest("li"))})}this.options.expandAll&&this.expandAll()};t.prototype={isRootNode:function(){return this.options.scope==this.el},listItem:function(t){return typeof t=="object"?n(t):this.el.find("["+this.options.idAttribute+'="'+t+'"]')},toggle:function(t){return n(t).hasClass("expanded")?this.collapse(t):this.expand(t)},expand:function(n){return this.setExpanded(n,!0)},collapse:function(n){return this.setExpanded(n,!1)},setExpanded:function(t,i){var r=this.listItem(t),u;if(r.length>1){u=this;r.each(function(){u.setExpanded(this,i)});return}if(i){if(!r.data("subList"))return;r=n(r).addClass("expanded").removeClass("collapsed");n(r.data("subList")).css("height","auto")}else r=n(r).addClass("collapsed").removeClass("expanded"),n(r.data("subList")).height(0);return r},expandAll:function(){this.expand(this.el.find("li"))},collapseAll:function(){this.collapse(this.el.find("li"))},expandTo:function(t){var r=this,i=this.listItem(t);return i.parents("li").each(function(){r.expand(n(this))}),i},update:function(){var t=this;this.el.children().each(function(){var i=n(this),u,r;t.options.createInputs&&t.insertInput(i);i.children().filter(".thumb").length==0&&(u=n('<div class="thumb"><\/div>'),i.prepend(u));r=i.children().filter("ol, ul");i.toggleClass("has-children",r.find("li").length>0);r.each(function(){if(n("li",this).length!=0){i.data("subList",this);i.hasClass("expanded")?t.expand(i):t.collapse(i);var r=!!n(this).data("bonsai");n(this).bonsai(r?"update":t.options)}})});this.expand=this.options.expand||this.expand;this.collapse=this.options.collapse||this.collapse},serialize:function(){var t=this.options.idAttribute;return this.el.find("li").toArray().reduce(function(i,r){var u=n(r),f=u.attr(t),e;return f&&(e=u.hasClass("expanded")?"expanded":u.hasClass("collapsed")?"collapsed":null,e&&i[u.hasClass("expanded")?"expanded":"collapsed"].push(f)),i},{expanded:[],collapsed:[],version:2})},restore:function(n){var t=this;n.version>1?(n.expanded.map(this.expand.bind(this)),n.collapsed.map(this.collapse.bind(this))):Object.keys(n).forEach(function(i){t.setExpanded(i,n[i]==="expanded")})},insertInput:function(t){var f=this.options.createInputs;if(!t.find("> input[type="+f+"]").length){var e=this.inputIdFor(t),r=n('<input type="'+f+'" name="'+this.inputNameFor(t)+'" id="'+e+'" /> '),i=t.children(),u=t.contents().filter(function(){return this.nodeType==3}).first();r.val(t.data("value"));r.prop("checked",t.data("checked"));i.detach();t.append(r).append(n('<label for="'+e+'">').append(u.length>0?u:i.first())).append(u.length>0?i:i.slice(1))}},checkboxPrefix:"bonsai-checkbox-",inputIdFor:function(i){for(var r=n(i).data("id");!r||n("#"+r).length>0;)r=this.checkboxPrefix+t.uniqueId++;return r},inputNameFor:function(n){return n.data("name")||n.parents().filter("[data-name]").data("name")},handleDuplicateCheckboxes:function(){var t=this;t.el.on("change","input[type=checkbox]",function(i){var r=n(i.target),u;r.val()&&(u='input[type=checkbox][value="'+r.val()+'"]'+(r.attr("name")?'[name="'+r.attr("name")+'"]':"")+(r.prop("checked")?":not(:checked)":":checked"),t.el.find(u).prop({checked:r.prop("checked"),indeterminate:r.prop("indeterminate")}).trigger("change"))})},addExpandAllLink:function(){var t=this;n('<div class="expand-all">').append(n('<a class="all">Expand all<\/a>').on("click",function(){t.expandAll()})).append('<i class="separator"><\/i>').append(n('<a class="none">Collapse all<\/a>').on("click",function(){t.collapseAll()})).insertBefore(this.el)},addSelectAllLink:function(){function t(){return i.find("li").filter(r.options.selectAllExclude||function(){return n(this).css("display")!="none"}).find("> input[type=checkbox]")}var i=this.options.scope,r=this;n('<div class="check-all">').append(n('<a class="all">Select all<\/a>').css("cursor","pointer").on("click",function(){t().prop({checked:!0,indeterminate:!1})})).append('<i class="separator"><\/i>').append(n('<a class="none">Select none<\/a>').css("cursor","pointer").on("click",function(){t().prop({checked:!1,indeterminate:!1})})).insertAfter(this.el)},setCheckedValues:function(t){var i=this.options.scope.find("input[type=checkbox]");n.each(t,function(n,t){i.filter('[value="'+t+'"]').prop("checked",!0).trigger("change")})}};n.extend(t,{uniqueId:0})})(jQuery);